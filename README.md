# master-java-technologies-tema2

Aplicația Java EE “ThreeDatabasesApp-1.0-SNAPSHOT” rulează pe **WildFly** și interacționează cu **baze de date Oracle, MSSQL și PostgreSQL** rulate în Docker. Aplicația gestionează entitățile **Studenți, Profesori și Cursuri**, prin JSP-uri și servlet-uri.

---

## Prerequisites

- IDE (IntelliJ IDEA recomandat)
- Java 8 (Corretto 1.8.0_462)
- Maven 3.x
- Docker și Docker Compose
- WildFly 19.1.0.Final
- Setarea variabilelor de mediu:
    - `JAVA_HOME` → directorul JDK 8
    - `WILDFLY_HOME` → directorul unde ai WildFly

---

## 1️⃣ Configurare baze de date

### 🟢 Pas 1: Pornește containerele Docker

```bash
cd docker-databases
docker-compose up -d
```

---

### 🟢 Pas 2: Conectare și populare Oracle

Conectează-te în containerul Oracle:

```bash
docker exec -it docker-databases-oracle-1 sqlplus univuser/password@XEPDB1
```

Exemplu de creare și populare tabel `COURSES`:

```sql
CREATE TABLE COURSES (
  id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name VARCHAR2(100) NOT NULL,
  teacher_id INT
);

INSERT INTO UNIVUSER.COURSES (id,name,teacher_id) VALUES (1,'Math 101', 1);
INSERT INTO UNIVUSER.COURSES (id,name,teacher_id) VALUES (2,'Physics 101', 2);

COMMIT;
```

> 💡 Atenție: `COMMIT;` este obligatoriu si se face manual!!!! pentru ca datele să fie vizibile. Mi-a luat 3 ore...

---

### 🟢 Pas 3: Populare MSSQL

**Windows:**

```bash
docker run -it --network=docker-databases_default \
  -v %cd%/mssql/init.sql:/init.sql:ro \
  mcr.microsoft.com/mssql-tools \
  /opt/mssql-tools/bin/sqlcmd -S docker-databases-mssql-1 -U sa -P "Password123!" -i /init.sql
```

**macOS:**

```bash
docker run -it --platform linux/amd64 --network=docker-databases_default \
  -v /Users/mmu8136/Desktop/Master/JavaTechnologies/master-java-technologies-tema2/docker-databases/mssql/init.sql:/init.sql:ro \
  mcr.microsoft.com/mssql-tools \
  /opt/mssql-tools/bin/sqlcmd -S docker-databases-mssql-1 -U sa -P "Password123\!" -i /init.sql
```

Verificare MSSQL:

```bash
docker run -it --network=docker-databases_default \
  mcr.microsoft.com/mssql-tools \
  /opt/mssql-tools/bin/sqlcmd -S docker-databases-mssql-1 -U univuser -P "Password123!"
```

```sql
USE univdb_mssql;
SELECT * FROM dbo.Teachers;
GO
```

---

### 🟢 Pas 4: Populare PostgreSQL

**Windows:**

```bash
psql -h localhost -p 5432 -U postgres -d univdb_postgres
```

**macOS:**

```bash
docker run -it --network=docker-databases_default -e PGPASSWORD=password \
  postgres \
  psql -h docker-databases-postgres-1 -U postgres -d univdb_postgres
```

Exemplu de creare tabel `Students` și populare:

```sql
CREATE TABLE Students (
  id SERIAL PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  email VARCHAR(100) UNIQUE NOT NULL
);

INSERT INTO Students (name, email) VALUES
('Alice', 'alice@example.com'),
('Bob', 'bob@example.com');
```

---

## 2️⃣ Build și deploy aplicație

### 🟢 Pas 1: Build cu Maven

```bash
mvn clean install
```

> ⚠️ Dacă se face build înainte de popularea bazelor de date, integration testele dau fail!!!!

---

### 🟢 Pas 2: Configurare WildFly

1. Șterge toate referințele la `ExampleDS` din:
    - `standalone.xml`
    - `standalone-full.xml`
    - `standalone-full-ha.xml`
    - `standalone-ha.xml`

2. (macOS doar) Asigură-te că `standalone.sh` e executabil:

```bash
chmod +x standalone.sh
```

3. Copiază WAR-ul în WildFly:

```bash
cp target/WildflyStudentApp-1.0-SNAPSHOT.war $WILDFLY_HOME/standalone/deployments/
```

4. Pornește serverul WildFly:

```bash
cd $WILDFLY_HOME/bin
./standalone.sh -Djboss.http.port=8082
```

> Pentru Windows folosim `standalone.bat`.

---

### 🟢 Pas 3: Accesare aplicație

Deschide browserul la:

```
http://localhost:8082/WildflyStudentApp
```

Veți vedea interfața pentru **Studenți, Profesori și Cursuri**, cu posibilitatea de a adăuga, modifica și șterge entități.

---

## 3️⃣ Structura proiectului

- `src/main/java/com/tema2/` – servlet-uri și EJB-uri pentru gestionarea entităților.
- `src/main/webapp/` – JSP-uri și fișiere statice.
- `docker-databases/mssql/init.sql` – script MSSQL.
- `docker-databases/postgres/init.sql` – script PostgreSQL.
- `docker-databases/oracle/init.sql` – script Oracle.
- `pom.xml` – dependințe Maven, Jakarta EE API `<scope>provided</scope>`.

---

## 4️⃣ Flow-ul aplicației

1. **UI JSP** → trimite request către **Servlet-uri WildFly**.
2. **API Servlets** -> strict pentru API Routing. Comunică cu **EJB-uri** pentru logică de business.
2. **UI Servlet** → Trimit in browser JSP-urile aferente path-ului.
3. **EJB-uri** → fac interogări JPA către bazele de date:
    - **Oracle** → Cursuri
    - **MSSQL** → Profesori
    - **PostgreSQL** → Studenți
4. **Rezultatul** este returnat UI servlet-ului → JSP → afișat în browser.

> Exemplu:  
Apasă “Adaugă student” → servlet validează datele → EJB salvează în PostgreSQL → JSP da refresh și afișează noul student în tabel.

---

## 5️⃣ Exemple de servlet-uri

- **StudentServlet.java**
```java
@WebServlet("/students")
public class StudentServlet extends HttpServlet {
    // GET, POST, PUT, DELETE pentru entitatea Student
}
```

- **CourseServlet.java**
```java
@WebServlet("/courses")
public class CourseServlet extends HttpServlet {
    // GET, POST, PUT, DELETE pentru entitatea Course
}
```

- **TeacherServlet.java**
```java
@WebServlet("/teachers")
public class TeacherServlet extends HttpServlet {
    // GET, POST, PUT, DELETE pentru entitatea Teacher
}
```

---

## 6️⃣ Cleanup

- Oprește containerele Docker:

Windows:
```bash
docker-compose down -v
```

MacOS:
```bash
docker compose down -v
```



> -v pentru stergerea volumelor!!!

- Oprește WildFly:

```
Ctrl+C în terminalul unde rulează standalone.sh
```

