# master-java-technologies-tema2

AplicaÈ›ia Java EE â€œThreeDatabasesApp-1.0-SNAPSHOTâ€ ruleazÄƒ pe **WildFly** È™i interacÈ›ioneazÄƒ cu **baze de date Oracle, MSSQL È™i PostgreSQL** rulate Ã®n Docker. AplicaÈ›ia gestioneazÄƒ entitÄƒÈ›ile **StudenÈ›i, Profesori È™i Cursuri**, prin JSP-uri È™i servlet-uri.

---

## Prerequisites

- IDE (IntelliJ IDEA recomandat)
- Java 8 (Corretto 1.8.0_462)
- Maven 3.x
- Docker È™i Docker Compose
- WildFly 19.1.0.Final
- Setarea variabilelor de mediu:
    - `JAVA_HOME` â†’ directorul JDK 8
    - `WILDFLY_HOME` â†’ directorul unde ai WildFly

---

## 1ï¸âƒ£ Configurare baze de date

### ğŸŸ¢ Pas 1: PorneÈ™te containerele Docker

```bash
cd docker-databases
docker-compose up -d
```

---

### ğŸŸ¢ Pas 2: Conectare È™i populare Oracle

ConecteazÄƒ-te Ã®n containerul Oracle:

```bash
docker exec -it docker-databases-oracle-1 sqlplus univuser/password@XEPDB1
```

Exemplu de creare È™i populare tabel `COURSES`:

```sql
CREATE TABLE COURSES (
  id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name VARCHAR2(100) NOT NULL,
  teacher_id INT
);

INSERT INTO UNIVUSER.COURSES (id,name,teacher_id) VALUES (1,'Math 101', 1);
INSERT INTO UNIVUSER.COURSES (id,name,teacher_id) VALUES (2,'Physics 101', 2);

COMMIT;
```

> ğŸ’¡ AtenÈ›ie: `COMMIT;` este obligatoriu si se face manual!!!! pentru ca datele sÄƒ fie vizibile. Mi-a luat 3 ore...

---

### ğŸŸ¢ Pas 3: Populare MSSQL

**Windows:**

```bash
docker run -it --network=docker-databases_default \
  -v %cd%/mssql/init.sql:/init.sql:ro \
  mcr.microsoft.com/mssql-tools \
  /opt/mssql-tools/bin/sqlcmd -S docker-databases-mssql-1 -U sa -P "Password123!" -i /init.sql
```

**macOS:**

```bash
docker run -it --platform linux/amd64 --network=docker-databases_default \
  -v /Users/mmu8136/Desktop/Master/JavaTechnologies/master-java-technologies-tema2/docker-databases/mssql/init.sql:/init.sql:ro \
  mcr.microsoft.com/mssql-tools \
  /opt/mssql-tools/bin/sqlcmd -S docker-databases-mssql-1 -U sa -P "Password123\!" -i /init.sql
```

Verificare MSSQL:

```bash
docker run -it --network=docker-databases_default \
  mcr.microsoft.com/mssql-tools \
  /opt/mssql-tools/bin/sqlcmd -S docker-databases-mssql-1 -U univuser -P "Password123!"
```

```sql
USE univdb_mssql;
SELECT * FROM dbo.Teachers;
GO
```

---

### ğŸŸ¢ Pas 4: Populare PostgreSQL

**Windows:**

```bash
psql -h localhost -p 5432 -U postgres -d univdb_postgres
```

**macOS:**

```bash
docker run -it --network=docker-databases_default -e PGPASSWORD=password \
  postgres \
  psql -h docker-databases-postgres-1 -U postgres -d univdb_postgres
```

Exemplu de creare tabel `Students` È™i populare:

```sql
CREATE TABLE Students (
  id SERIAL PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  email VARCHAR(100) UNIQUE NOT NULL
);

INSERT INTO Students (name, email) VALUES
('Alice', 'alice@example.com'),
('Bob', 'bob@example.com');
```

---

## 2ï¸âƒ£ Build È™i deploy aplicaÈ›ie

### ğŸŸ¢ Pas 1: Build cu Maven

```bash
mvn clean install
```

> âš ï¸ DacÄƒ se face build Ã®nainte de popularea bazelor de date, integration testele dau fail!!!!

---

### ğŸŸ¢ Pas 2: Configurare WildFly

1. È˜terge toate referinÈ›ele la `ExampleDS` din:
    - `standalone.xml`
    - `standalone-full.xml`
    - `standalone-full-ha.xml`
    - `standalone-ha.xml`

2. (macOS doar) AsigurÄƒ-te cÄƒ `standalone.sh` e executabil:

```bash
chmod +x standalone.sh
```

3. CopiazÄƒ WAR-ul Ã®n WildFly:

```bash
cp target/WildflyStudentApp-1.0-SNAPSHOT.war $WILDFLY_HOME/standalone/deployments/
```

4. PorneÈ™te serverul WildFly:

```bash
cd $WILDFLY_HOME/bin
./standalone.sh -Djboss.http.port=8082
```

> Pentru Windows folosim `standalone.bat`.

---

### ğŸŸ¢ Pas 3: Accesare aplicaÈ›ie

Deschide browserul la:

```
http://localhost:8082/WildflyStudentApp
```

VeÈ›i vedea interfaÈ›a pentru **StudenÈ›i, Profesori È™i Cursuri**, cu posibilitatea de a adÄƒuga, modifica È™i È™terge entitÄƒÈ›i.

---

## 3ï¸âƒ£ Structura proiectului

- `src/main/java/com/tema2/` â€“ servlet-uri È™i EJB-uri pentru gestionarea entitÄƒÈ›ilor.
- `src/main/webapp/` â€“ JSP-uri È™i fiÈ™iere statice.
- `docker-databases/mssql/init.sql` â€“ script MSSQL.
- `docker-databases/postgres/init.sql` â€“ script PostgreSQL.
- `docker-databases/oracle/init.sql` â€“ script Oracle.
- `pom.xml` â€“ dependinÈ›e Maven, Jakarta EE API `<scope>provided</scope>`.

---

## 4ï¸âƒ£ Flow-ul aplicaÈ›iei

1. **UI JSP** â†’ trimite request cÄƒtre **Servlet-uri WildFly**.
2. **API Servlets** -> strict pentru API Routing. ComunicÄƒ cu **EJB-uri** pentru logicÄƒ de business.
2. **UI Servlet** â†’ Trimit in browser JSP-urile aferente path-ului.
3. **EJB-uri** â†’ fac interogÄƒri JPA cÄƒtre bazele de date:
    - **Oracle** â†’ Cursuri
    - **MSSQL** â†’ Profesori
    - **PostgreSQL** â†’ StudenÈ›i
4. **Rezultatul** este returnat UI servlet-ului â†’ JSP â†’ afiÈ™at Ã®n browser.

> Exemplu:  
ApasÄƒ â€œAdaugÄƒ studentâ€ â†’ servlet valideazÄƒ datele â†’ EJB salveazÄƒ Ã®n PostgreSQL â†’ JSP da refresh È™i afiÈ™eazÄƒ noul student Ã®n tabel.

---

## 5ï¸âƒ£ Exemple de servlet-uri

- **StudentServlet.java**
```java
@WebServlet("/students")
public class StudentServlet extends HttpServlet {
    // GET, POST, PUT, DELETE pentru entitatea Student
}
```

- **CourseServlet.java**
```java
@WebServlet("/courses")
public class CourseServlet extends HttpServlet {
    // GET, POST, PUT, DELETE pentru entitatea Course
}
```

- **TeacherServlet.java**
```java
@WebServlet("/teachers")
public class TeacherServlet extends HttpServlet {
    // GET, POST, PUT, DELETE pentru entitatea Teacher
}
```

---

## 6ï¸âƒ£ Cleanup

- OpreÈ™te containerele Docker:

Windows:
```bash
docker-compose down -v
```

MacOS:
```bash
docker compose down -v
```



> -v pentru stergerea volumelor!!!

- OpreÈ™te WildFly:

```
Ctrl+C Ã®n terminalul unde ruleazÄƒ standalone.sh
```

